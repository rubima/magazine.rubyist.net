<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Ruby 2.0.0： Keyword arguments</title>
  <meta name="description" content="Author: Yusuke EndohTranslator: Leonard Chin (@lchin)">

  <script src="/js/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link href="/css/theme.css" rel="stylesheet" type="text/css">
  <link href="/css/syntax.css" rel="stylesheet" type="text/css">

  <link rel="canonical" href="http://magazine.rubyist.net/articles/ruby200specialen/Ruby200SpecialEn-kwarg.html">
  <link rel="alternate" type="application/rss+xml" title="Rubyist Magazine" href="http://magazine.rubyist.net/feed.xml">
  <link rel="shortcut icon" href="/images/favicon.ico">
</head>

  <body>
    <div class="container container-left">
        <div class="row">
            <div class="col-md-1 hidden-xs sidebar">
                <h4>

</h4>

<h4>バックナンバー</h4>
<ul>
    
        <li><a href="/articles/0056/0056-index.html">0056号(2017-08)</a></li>
    
        <li><a href="/articles/0055/0055-index.html">0055号(2017-03)</a></li>
    
        <li><a href="/articles/0054/0054-index.html">0054号(2016-08)</a></li>
    
        <li><a href="/articles/pretokyorubykaigi11/preTokyoRubyKaigi11.html">東京 Ruby 会議 11 直前特集号</a></li>
    
        <li><a href="/articles/0053/0053-index.html">0053号(2016-04)</a></li>
    
        <li><a href="/articles/0052/0052-index.html">0052号(2015-12)</a></li>
    
        <li><a href="/articles/0051/0051-index.html">0051号(2015-09)</a></li>
    
        <li><a href="/articles/0050/0050-index.html">0050号(2015-05)</a></li>
    
        <li><a href="/articles/0049/0049-index.html">0049号(2014-12)</a></li>
    
        <li><a href="/articles/0048/0048-index.html">0048号(2014-09)</a></li>
    
        <li><a href="/articles/0047/0047-index.html">0047号(2014-06)</a></li>
    
        <li><a href="/articles/0046/0046-index.html">0046号(2014-04)</a></li>
    
        <li><a href="/articles/0045/0045-index.html">0045号(2013-12)</a></li>
    
        <li><a href="/articles/0044/0044-index.html">0044号(2013-09)</a></li>
    
        <li><a href="/articles/0043/0043-index.html">0043号(2013-07)</a></li>
    
        <li><a href="/articles/0042/0042-index.html">0042号(2013-05)</a></li>
    
        <li><a href="/articles/ruby200specialen/Ruby200SpecialEn.html">2.0.0 Special (EN)</a></li>
    
        <li><a href="/articles/0041/0041-index.html">0041号(2013-02)</a></li>
    
        <li><a href="/articles/0040/0040-index.html">0040号(2012-11)</a></li>
    
        <li><a href="/articles/0039/0039-index.html">0039号(2012-09)</a></li>
    
        <li><a href="/articles/rubykaja/kaja.html">RubyKaja のご紹介</a></li>
    
        <li><a href="/articles/0038/0038-index.html">0038号(2012-05)</a></li>
    
        <li><a href="/articles/0037/0037-index.html">0037号(2012-02)</a></li>
    
        <li><a href="/articles/0036/0036-index.html">0036号(2011-11)</a></li>
    
        <li><a href="/articles/0035/0035-index.html">0035号(2011-09)</a></li>
    
        <li><a href="/articles/prerubykaigi2011/preRubyKaigi2011.html">RubyKaigi2011直前特集号</a></li>
    
        <li><a href="/articles/0034/0034-index.html">0034号(2011-06)</a></li>
    
        <li><a href="/articles/0033/0033-index.html">0033号(2011-04)</a></li>
    
        <li><a href="/articles/0032/0032-index.html">0032号(2011-01)</a></li>
    
        <li><a href="/articles/0031/0031-index.html">0031号(2010-10)</a></li>
    
        <li><a href="/articles/prerubykaigi2010/preRubyKaigi2010.html">RubyKaigi2010直前特集号</a></li>
    
        <li><a href="/articles/0030/0030-index.html">0030号(2010-06)</a></li>
    
        <li><a href="/articles/0029/0029-index.html">0029号(2010-03)</a></li>
    
        <li><a href="/articles/0028/0028-index.html">0028号(2009-12)</a></li>
    
        <li><a href="/articles/0027/0027-index.html">0027号(2009-09)</a></li>
    
        <li><a href="/articles/0026/0026-index.html">0026号(2009-06)</a></li>
    
        <li><a href="/articles/0025/0025-index.html">0025号(2009-02)</a></li>
    
        <li><a href="/articles/0024/0024-index.html">0024号(2008-10)</a></li>
    
        <li><a href="/articles/0023/0023-index.html">0023号(2008-03)</a></li>
    
        <li><a href="/articles/0022/0022-index.html">0022号(2007-12)</a></li>
    
        <li><a href="/articles/0021/0021-index.html">0021号(2007-09)</a></li>
    
        <li><a href="/articles/0020/0020-index.html">0020号(2007-08)</a></li>
    
        <li><a href="/articles/0019/0019-index.html">0019号(2007-05)</a></li>
    
        <li><a href="/articles/0018/0018-index.html">0018号(2007-02)</a></li>
    
        <li><a href="/articles/0017/0017-index.html">0017号(2006-11)</a></li>
    
        <li><a href="/articles/0016/0016-index.html">0016号(2006-09)</a></li>
    
        <li><a href="/articles/0015/0015-index.html">0015号(2006-07)</a></li>
    
        <li><a href="/articles/rubykaigi2006/RubyKaigi2006-index.html">日本 Ruby カンファレンス 2006 特別号</a></li>
    
        <li><a href="/articles/0014/0014-index.html">0014号(2006-05)</a></li>
    
        <li><a href="/articles/0013/0013-index.html">0013号(2006-02)</a></li>
    
        <li><a href="/articles/0012/0012-index.html">0012号(2005-12)</a></li>
    
        <li><a href="/articles/0011/0011-index.html">0011号(2005-11)</a></li>
    
        <li><a href="/articles/0010/0010-index.html">0010号(2005-10)</a></li>
    
        <li><a href="/articles/0009/0009-index.html">0009号(2005-09)</a></li>
    
        <li><a href="/articles/0008/0008-index.html">0008号(2005-07)</a></li>
    
        <li><a href="/articles/0007/0007-index.html">0007号(2005-06)</a></li>
    
        <li><a href="/articles/0006/0006-index.html">0006号(2005-05)</a></li>
    
        <li><a href="/articles/0005/0005-index.html">0005号(2005-02)</a></li>
    
        <li><a href="/articles/0004/0004-index.html">0004号(2004-12)</a></li>
    
        <li><a href="/articles/0003/0003-index.html">0003号(2004-11)</a></li>
    
        <li><a href="/articles/0002/0002-index.html">0002号(2004-10)</a></li>
    
        <li><a href="/articles/0001/0001-index.html">0001号(2004-09)</a></li>
    
</ul>
<p class="rss-subscribe"><a href="/feed.xml">RSS</a></p>

            </div>
            <div class="col-md-11 main">
                <img src="/images/rubima_logo_l.png">
                <h1>Ruby 2.0.0： Keyword arguments</h1>
                <div class="social-buttons">
                    <a href="http://b.hatena.ne.jp/entry//articles/ruby200specialen/Ruby200SpecialEn-kwarg.html" class="hatena-bookmark-button" data-hatena-bookmark-title="Ruby 2.0.0： Keyword arguments" data-hatena-bookmark-layout="simple-balloon" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
<span id="fb-root"></span>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/ja_JP/sdk.js#xfbml=1&version=v2.5";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<span class="fb-like" data-href="/articles/ruby200specialen/Ruby200SpecialEn-kwarg.html" data-layout="button_count" data-action="like" data-show-faces="false" data-share="false"></span>
<a href="https://twitter.com/share" class="twitter-share-button" data-url="/articles/ruby200specialen/Ruby200SpecialEn-kwarg.html" data-text="Ruby 2.0.0： Keyword arguments">ツイート</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

                </div>
                <p>Author: Yusuke Endoh
Translator: Leonard Chin (<a href="https://twitter.com/lchin">@lchin</a>)</p>

<h2 id="foreword">Foreword</h2>

<p>Congratulations for the release of Ruby 2.0.0!</p>

<p>In this article, I will introduce one of the new features in Ruby 2.0.0, Keyword Arguments.</p>

<h2 id="keyword-arguments-in-a-nutshell">Keyword Arguments in a Nutshell</h2>

<p>The following example implements a logging method.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">def log(msg, level: "ERROR", time: Time.now)
  puts "#{ time.ctime } [#{ level }] #{ msg }"
end</code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">log("Hello!", level: "INFO")  #=&gt; Mon Feb 18 01:46:22 2013 [INFO] Hello!</code></pre></figure>

<p>It looks so ordinary. It doesn’t exactly look like anything new, does it?</p>

<h2 id="explanation">Explanation</h2>

<p>We can already call methods with keyword arguments in 1.9.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">log("Hello!", level: "INFO")</code></pre></figure>

<p>The keyword arguments here are passed to the method as the hash  { :level =&gt; “INFO” } 
To actually make use of the arguments, we need to access them through the hash.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">def log(msg, opt = {})
  level = opt[:level] || "ERROR"
  time  = opt[:time]  || Time.now
  puts "#{ time.ctime } [#{ level }] #{ msg }"
end</code></pre></figure>

<p>So far, it isn’t all that complicated. However, things can get hairy real fast if we consider the following situations</p>

<ul>
  <li>Using keyword arguments along with variable length argument lists</li>
  <li>Raising exceptions when we get unexpected keyword arguments</li>
  <li>When we want to pass in nil as an argument</li>
</ul>

<p>To handle all the above cases, we end up with something like the following.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">def log(*msgs)
  opt = msgs.last.is_a?(Hash) ? msgs.pop : {}
  level = opt.key?(:level) ? opt.delete(:level) : "ERROR"
  time  = opt.key?(:time ) ? opt.delete(:time ) : Time.now
  raise "unknown keyword: #{ opt.keys.first }" if !opt.empty?
  msgs.each {|msg| puts "#{ time.ctime } [#{ level }] #{ msg }" }
end</code></pre></figure>

<p>Not something you’d want to write over and over again. 
Handling these kinds of situations is the motivation behind keyword arguments.
By using this new feature of Ruby 2.0.0, we can process keyword arguments extremely cleanly.
Just like our opening example, in fact.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">def log(msg, level: "ERROR", time: Time.now)
  puts "#{ time.ctime } [#{ level }] #{ msg }"
end</code></pre></figure>

<h2 id="a-little-more-detail">A Little More Detail…</h2>

<p>When we call this method without any keyword arguments, it behaves as we had passed it level: “ERROR”, time: Time.now</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">log("Hello!")                                  #=&gt; Mon Feb 18 01:46:22 2013 [ERROR] Hello!
log("Hello!", level: "ERROR", time: Time.now)  #=&gt; Mon Feb 18 01:46:22 2013 [ERROR] Hello!</code></pre></figure>

<p>Order is not important of keyword arguments. However, you still need to pay attention to the order of the other arguments.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">log("Hello!", time: Time.now, level: "ERROR")  #=&gt; Mon Feb 18 01:46:22 2013 [ERROR] Hello!
log(level: "ERROR", time: Time.now, "Hello!")  # This doesn't work</code></pre></figure>

<p>You can even leave out one of the keyword arguments.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">log("Hello!", level: "INFO")  #=&gt; Mon Feb 18 01:46:22 2013 [INFO] Hello!</code></pre></figure>

<p>If you supply an unknown keyword, an exception is raised.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">log("Hello!", date: Time.new)  #=&gt; unknown keyword: date</code></pre></figure>

<p>Those who don’t want exceptions to be raised for unknown keywords can specify a hash argument with ** to explicitly group the other keyword arguments.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">def log(msg, level: "ERROR", time: Time.now, **kwrest)
  puts "#{ time.ctime } [#{ level }] #{ msg }"
end

log("Hello!", date: Time.now)  #=&gt; Mon Feb 18 01:46:22 2013 [ERROR] Hello!</code></pre></figure>

<p>It is also possible to combine keyword arguments with optional arguments or variable-length argument lists. (But don’t go overboard!)</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">def f(a, b, c, m = 1, n = 1, *rest, x, y, z, k: 1, **kwrest, &amp;blk)
  puts "a: %p" % a
  puts "b: %p" % b
  puts "c: %p" % c
  puts "m: %p" % m
  puts "n: %p" % n
  puts "rest: %p" % rest
  puts "x: %p" % x
  puts "y: %p" % y
  puts "z: %p" % z
  puts "k: %p" % k
  puts "kwrest: %p" % kwrest
  puts "blk: %p" % blk
end

f("a", "b", "c", 2, 3, "foo", "bar", "baz", "x", "y", "z", k: 42, u: "unknown") { }
  #=&gt; a: "a"
      b: "b"
      c: "c"
      m: 2
      n: 3
      rest: "foo"
      x: "x"
      y: "y"
      z: "z"
      k: 42
      kwrest: {:u=&gt;"unknown"}
      blk: #&lt;Proc:0x007f7e7d8dd6c0@-:16&gt;</code></pre></figure>

<h2 id="limitations">Limitations</h2>

<p>Be careful when passing hashes to methods with both variable length argument lists and keyword arguments. For example, in the case below, the last hash is interpreted as a keyword argument and won’t be assigned to the args parameter.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">def foo(*args, k: 1)
  p args
end

args = [{}, {}, {}]

foo(*args) #=&gt; [{}, {}]</code></pre></figure>

<p>Also, you cannot omit the name of the ** parameter used to suppress unknown keyword exceptions.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">def foo(**)
end
foo(k: 1) #=&gt; unknown keyword: k</code></pre></figure>

<p>(While writing this article, I started having doubts about this behaviour…)<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup></p>

<p>Care must also be taken when rewriting existing functions to take advantage of this feature. Unlike hash keys, keywords can not be reserved words in Ruby.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">def foo(if: false)
end
foo(if: true)</code></pre></figure>

<p>The above code won’t explicitly fail, but you won’t be able to access the contents of the local variable named <code class="highlighter-rouge">if</code>. To get around this, you will need to use the ** parameter.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">def foo(**kwrest)
  p kwrest[:if]
end
foo(if: true) #=&gt; true</code></pre></figure>

<h2 id="closing-thoughts">Closing Thoughts</h2>

<p>In Ruby 2.0.0, keyword arguments were made available by adding new syntax for defining method parameters.</p>

<p>The implementation of the feature is mostly syntax sugar, and can hardly be called a significant new feature. From the standpoint of the Ruby culture, however, I believe it is important that keyword arguments are now first class citizens.
I think we will be seeing many new APIs taking advantage of keyword arguments, hopefully making your Ruby life just a little bit nicer.</p>

<h2 id="about-the-author">About the Author</h2>

<p>Yusuke Endoh is a Ruby committer (account: mame). His contributions include increasing the test coverage of Ruby, serving as the assistant Release Manager of Ruby 1.9.2, and the Release Manager of Ruby 2.0.0.</p>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>This behaviour has been fixed. It will be included in a future patch level release of Ruby. https://bugs.ruby-lang.org/issues/7922&nbsp;<a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

            </div>
        </div>
    </div>
  </body>
</html>
<!DOCTYPE html>
<html>
